<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Wymagana weryfikacja</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #f0f0f0;
      min-height: 100dvh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    /* CAPTCHA Container */
    .captcha-container {
      width: 100%;
      max-width: 360px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.15);
      overflow: hidden;
      animation: slideUp 0.4s ease-out;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* Header */
    .captcha-header {
      background: #4a90d9;
      color: white;
      padding: 18px 16px 14px;
    }

    .captcha-header h2 {
      font-size: 22px;
      font-weight: 500;
      line-height: 1.3;
      margin-bottom: 4px;
    }

    .captcha-header h2 strong {
      font-weight: 700;
    }

    .captcha-header p {
      font-size: 13px;
      opacity: 0.85;
    }

    /* Image Grid */
    .captcha-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 3px;
      padding: 3px;
      background: #fff;
    }

    .captcha-cell {
      position: relative;
      aspect-ratio: 1;
      cursor: pointer;
      overflow: hidden;
      border-radius: 2px;
      background: #e0e0e0;
    }

    .captcha-cell img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transition: transform 0.2s ease;
      pointer-events: none;
    }

    .captcha-cell.selected img {
      transform: scale(0.88);
      border-radius: 8px;
    }

    /* Checkmark overlay */
    .captcha-cell .check-overlay {
      position: absolute;
      bottom: 6px;
      left: 6px;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: #4a90d9;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transform: scale(0.5);
      transition: all 0.2s ease;
    }

    .captcha-cell.selected .check-overlay {
      opacity: 1;
      transform: scale(1);
    }

    .check-overlay svg {
      width: 16px;
      height: 16px;
      fill: none;
      stroke: white;
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    /* Dim border for selected */
    .captcha-cell::after {
      content: '';
      position: absolute;
      inset: 0;
      border: 3px solid #4a90d9;
      border-radius: 2px;
      opacity: 0;
      transition: opacity 0.2s ease;
      pointer-events: none;
    }

    .captcha-cell.selected::after {
      opacity: 1;
    }

    /* Footer */
    .captcha-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      border-top: 1px solid #e8e8e8;
    }

    .captcha-logo {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: #999;
    }

    .captcha-logo svg {
      width: 24px;
      height: 24px;
    }

    .verify-btn {
      background: #4a90d9;
      color: white;
      border: none;
      padding: 10px 28px;
      border-radius: 4px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      letter-spacing: 0.3px;
    }

    .verify-btn:active {
      transform: scale(0.97);
    }

    .verify-btn:hover {
      background: #3a7bc8;
    }

    /* Error shake */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%      { transform: translateX(-8px); }
      40%      { transform: translateX(8px); }
      60%      { transform: translateX(-6px); }
      80%      { transform: translateX(6px); }
    }

    .captcha-container.shake {
      animation: shake 0.5s ease;
    }

    .error-msg {
      text-align: center;
      color: #d9534f;
      font-size: 13px;
      padding: 0 16px 10px;
      display: none;
    }

    .error-msg.visible {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .success-screen {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      min-height: 100dvh;
      padding: 32px 24px;
      background: linear-gradient(135deg, #ffeef8 0%, #fff0f0 30%, #fff5f0 60%, #ffeef8 100%);
      position: fixed;
      inset: 0;
      z-index: 100;
      overflow: hidden;
    }

    .success-screen.active {
      display: flex;
      animation: fadeIn 0.6s ease;
    }

    /* Floating hearts background */
    .hearts-bg {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
    }

    .floating-heart {
      position: absolute;
      font-size: 24px;
      animation: floatUp linear infinite;
      opacity: 0;
    }

    @keyframes floatUp {
      0%   { transform: translateY(100vh) rotate(0deg); opacity: 0; }
      10%  { opacity: 0.7; }
      90%  { opacity: 0.7; }
      100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
    }

    .success-badge {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ff6b8a, #ff4081);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 24px;
      box-shadow: 0 4px 20px rgba(255,64,129,0.35);
      animation: popIn 0.5s ease 0.3s both;
      position: relative;
      z-index: 1;
    }

    @keyframes popIn {
      0%   { transform: scale(0); }
      70%  { transform: scale(1.15); }
      100% { transform: scale(1); }
    }

    .success-badge svg {
      width: 40px;
      height: 40px;
      fill: white;
    }

    .success-title {
      font-size: 32px;
      font-weight: 800;
      color: #e91e63;
      margin-bottom: 12px;
      animation: popIn 0.5s ease 0.5s both;
      position: relative;
      z-index: 1;
    }

    .success-subtitle {
      font-size: 18px;
      color: #c2185b;
      margin-bottom: 8px;
      font-weight: 600;
      animation: popIn 0.5s ease 0.65s both;
      position: relative;
      z-index: 1;
    }

    .success-message {
      font-size: 16px;
      color: #666;
      line-height: 1.6;
      max-width: 300px;
      animation: popIn 0.5s ease 0.8s both;
      position: relative;
      z-index: 1;
      margin-bottom: 32px;
    }

    .success-heart-big {
      font-size: 64px;
      animation: heartbeat 1.2s ease infinite;
      position: relative;
      z-index: 1;
    }

    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      15%      { transform: scale(1.15); }
      30%      { transform: scale(1); }
      45%      { transform: scale(1.1); }
      60%      { transform: scale(1); }
    }

    /* Styl placeholder zdjƒôƒá (do demo zanim dodasz prawdziwe zdjƒôcia) */
    .placeholder-img {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      background: linear-gradient(135deg, #f5f5f5, #e8e8e8);
      user-select: none;
    }

    .placeholder-img.me {
      background: linear-gradient(135deg, #ffe0ec, #ffd6e0);
    }
  </style>
</head>
<body>
  <div class="captcha-container" id="captchaContainer">
    <div class="captcha-header">
      <h2>Wybierz wszystkie zdjƒôcia z<br><strong id="targetName">TwojƒÖ WalentynkƒÖ</strong></h2>
      <p>Je≈õli nie ma ≈ºadnych, kliknij weryfikuj.</p>
    </div>

    <div class="captcha-grid" id="captchaGrid">
      <!-- Cells generated by JavaScript -->
    </div>

    <div class="error-msg" id="errorMsg">
      Spr√≥buj ponownie. Zaznacz wszystkie prawid≈Çowe zdjƒôcia.
    </div>

    <div class="captcha-footer">
      <div class="captcha-logo">
        <svg viewBox="0 0 24 24" fill="none" stroke="#bbb" stroke-width="1.5">
          <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/>
          <path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/>
          <circle cx="12" cy="17" r=".5" fill="#bbb"/>
        </svg>
        <span>luvCAPTCHA</span>
      </div>
      <button class="verify-btn" id="verifyBtn" onclick="verify()">WERYFIKUJ</button>
    </div>
  </div>

  <!-- ============================================================
       EKRAN SUKCESU
       ============================================================ -->
  <div class="success-screen" id="successScreen">
    <div class="hearts-bg" id="heartsBg"></div>

    <div class="success-badge">
      <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
    </div>

    <div class="success-title">Weryfikacja zaliczona!</div>
    <div class="success-subtitle" id="successSubtitle">Z</div>
    <div class="success-message" id="successMessage">
      Weso≈Çych Walentynek, Tyniaczku kochany! ü•∞<br> <br><br>
      Czy bƒôdziesz mojƒÖ WalentynkƒÖ? ‚ù§Ô∏è
    </div>
    <div class="success-heart-big">üíù</div>
  </div>

  <script>
    const TARGET_NAME = "TwojƒÖ WalentynkƒÖ"; // <-- Twoje imiƒô tutaj!

    const PHOTOS = [
      { src: "images/me1.png", emoji: "üßë",  isMe: true  },
      { src: "images/not_me3.jpeg", emoji: "üê∂",  isMe: false },
      { src: "images/me2.png", emoji: "üßë",  isMe: true  },
      { src: "images/not_me2.jpeg", emoji: "üåÆ",  isMe: false },
      { src: "images/me3.png", emoji: "üßë",  isMe: true  },
      { src: "images/me4.png", emoji: "üßë",  isMe: true  },
      { src: "images/me5.png", emoji: "üé∏",  isMe: true },
      { src: "images/me6.png", emoji: "ü¶ä",  isMe: true },
      { src: "images/not_me1.png", emoji: "üßë",  isMe: false  },
    ];

    /* Opcjonalnie: dostosuj wiadomo≈õƒá ko≈ÑcowƒÖ */
    const SUCCESS_SUBTITLE = "";
    const SUCCESS_MESSAGE = `
      Weso≈Çych Walentynek, Tyniaczku kochany! ü•∞<br> <br><br>
      Czy bƒôdziesz mojƒÖ WalentynkƒÖ? ‚ù§Ô∏è
    `;

    /* ==========================================================
       LOGIKA CAPTCHA ‚Äî nie musisz edytowaƒá poni≈ºej
       ========================================================== */

    // Tasowanie tablicy (Fisher-Yates)
    function shuffle(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // Stan
    let cells = [];
    let selected = new Set();
    let attempts = 0;

    function init() {
      document.getElementById("targetName").textContent = TARGET_NAME;
      document.getElementById("successSubtitle").innerHTML = SUCCESS_SUBTITLE;
      document.getElementById("successMessage").innerHTML = SUCCESS_MESSAGE;

      const shuffled = shuffle(PHOTOS.map((p, i) => ({ ...p, originalIndex: i })));
      const grid = document.getElementById("captchaGrid");
      grid.innerHTML = "";

      shuffled.forEach((photo, idx) => {
        const cell = document.createElement("div");
        cell.className = "captcha-cell";
        cell.dataset.idx = idx;
        cell.dataset.isMe = photo.isMe;

        if (photo.src) {
          const img = document.createElement("img");
          img.src = photo.src;
          img.alt = "obrazek captcha";
          img.draggable = false;
          cell.appendChild(img);
        } else {
          const placeholder = document.createElement("div");
          placeholder.className = "placeholder-img" + (photo.isMe ? " me" : "");
          placeholder.textContent = photo.emoji || "‚ùì";
          cell.appendChild(placeholder);
        }

        // Checkmark
        const checkOverlay = document.createElement("div");
        checkOverlay.className = "check-overlay";
        checkOverlay.innerHTML = `<svg viewBox="0 0 24 24"><polyline points="4 12 9 17 20 6"/></svg>`;
        cell.appendChild(checkOverlay);

        cell.addEventListener("click", () => toggleCell(idx, cell));
        grid.appendChild(cell);
      });

      cells = shuffled;
    }

    function toggleCell(idx, cellEl) {
      if (selected.has(idx)) {
        selected.delete(idx);
        cellEl.classList.remove("selected");
      } else {
        selected.add(idx);
        cellEl.classList.add("selected");
      }
      // Ukryj b≈ÇƒÖd po interakcji
      document.getElementById("errorMsg").classList.remove("visible");
    }

    function verify() {
      const correctIndices = new Set();
      cells.forEach((cell, idx) => {
        if (cell.isMe) correctIndices.add(idx);
      });

      // Sprawd≈∫ czy wyb√≥r jest prawid≈Çowy
      const isCorrect =
        selected.size === correctIndices.size &&
        [...selected].every(i => correctIndices.has(i));

      if (isCorrect) {
        showSuccess();
      } else {
        attempts++;
        const container = document.getElementById("captchaContainer");
        const errorMsg = document.getElementById("errorMsg");

        if (attempts >= 3) {
          errorMsg.textContent = "Podpowied≈∫: Wybierz wszystkie zdjƒôcia z " + TARGET_NAME + "em! üíï";
        } else {
          errorMsg.textContent = "Spr√≥buj ponownie. Zaznacz wszystkie prawid≈Çowe zdjƒôcia.";
        }

        errorMsg.classList.add("visible");
        container.classList.remove("shake");
        // Wymu≈õ reflow ≈ºeby zrestartowaƒá animacjƒô
        void container.offsetWidth;
        container.classList.add("shake");

        // Resetuj zaznaczenia
        selected.clear();
        document.querySelectorAll(".captcha-cell").forEach(c => c.classList.remove("selected"));
      }
    }

    function showSuccess() {
      document.getElementById("successScreen").classList.add("active");
      spawnFloatingHearts();
    }

    function spawnFloatingHearts() {
      const container = document.getElementById("heartsBg");
      const hearts = ["üíñ", "üíï", "üíó", "üíì", "‚ù§Ô∏è", "üíò", "üíù", "ü©∑", "üåπ", "‚ú®"];
      const count = 30;

      for (let i = 0; i < count; i++) {
        const heart = document.createElement("div");
        heart.className = "floating-heart";
        heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
        heart.style.left = Math.random() * 100 + "%";
        heart.style.fontSize = (16 + Math.random() * 24) + "px";
        heart.style.animationDuration = (5 + Math.random() * 8) + "s";
        heart.style.animationDelay = (Math.random() * 6) + "s";
        container.appendChild(heart);
      }
    }

    // Start!
    init();
  </script>
</body>
</html>
